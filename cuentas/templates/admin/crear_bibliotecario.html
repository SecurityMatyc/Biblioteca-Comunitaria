{% extends "base_panel.html" %}
{% load static %}
{% block content %}

<div class="container mt-5 pt-5">

  <!-- TÍTULO -->
  <div class="text-center mb-5">
    <h1 class="display-5">Crear Bibliotecario</h1>
    <p class="text-muted">
      Registro de nuevos bibliotecarios del sistema
    </p>
  </div>

  <!-- CARD FORMULARIO -->
  <div class="row justify-content-center">
    <div class="col-md-7 col-lg-6">

      <div class="card shadow-lg border-0">
        <div class="card-body p-5">

          <div class="text-center mb-4">
            <i class="fas fa-user-plus fa-3x text-success mb-3"></i>
            <h4 class="mb-0">Datos del Bibliotecario</h4>
          </div>


          <form method="post" novalidate>
            {% csrf_token %}
            {% if form.non_field_errors %}
              <div class="alert alert-danger">
                <ul class="mb-0">
                  {% for error in form.non_field_errors %}
                    <li>{{ error }}</li>
                  {% endfor %}
                </ul>
              </div>
            {% endif %}

            <!-- USUARIO (eliminado, username se genera automáticamente) -->

            <div class="mb-3">
              <label class="form-label">Correo electrónico</label>
              {{ form.email }}
              {% if form.email.errors %}
                <div class="text-danger small mt-1">{{ form.email.errors.0 }}</div>
              {% endif %}
            </div>

            <!-- CONTRASEÑAS -->
            <div class="row">
              <div class="col-md-6 mb-3">
                <label class="form-label">Contraseña</label>
                {{ form.password1 }}
                {% if form.password1.errors %}
                  <div class="text-danger small mt-1">{{ form.password1.errors.0 }}</div>
                {% endif %}
                <div id="passwordHelp" class="form-text mt-1">
                  <strong>Requisitos:</strong>
                  <ul class="mb-0" style="padding-left: 18px;">
                    <li id="pw-len" class="text-danger">Al menos 8 caracteres</li>
                    <li id="pw-mix" class="text-danger">Debe contener letras y números</li>
                  </ul>
                </div>
              </div>
              <div class="col-md-6 mb-3">
                <label class="form-label">Confirmar contraseña</label>
                {{ form.password2 }}
                {% if form.password2.errors %}
                  <div class="text-danger small mt-1">{{ form.password2.errors.0 }}</div>
                {% endif %}
              </div>
            </div>

            <hr class="my-4">

            <!-- DATOS PERSONALES -->
            <h6 class="text-muted mb-3">Información adicional</h6>

            <div class="mb-3">
              <label class="form-label">RUT</label>
              {{ form.rut }}
              {% if form.rut.errors %}
                <div class="text-danger small mt-1">{{ form.rut.errors.0 }}</div>
              {% endif %}
            </div>

            <div class="mb-3">
              <label class="form-label">Dirección</label>
              {{ form.direccion }}
              {% if form.direccion.errors %}
                <div class="text-danger small mt-1">{{ form.direccion.errors.0 }}</div>
              {% endif %}
            </div>

            <div class="mb-4">
              <label class="form-label">Teléfono</label>
              {{ form.telefono }}
              {% if form.telefono.errors %}
                <div class="text-danger small mt-1">{{ form.telefono.errors.0 }}</div>
              {% endif %}
            </div>

            <!-- BOTONES -->
            <div class="d-grid gap-3">
              <button type="submit" class="btn btn-success btn-lg">
                <i class="fas fa-save me-2"></i>Crear Bibliotecario
              </button>

              <a href="{% url 'dashboard' %}" class="btn btn-outline-dark btn-lg">
                <i class="fas fa-arrow-left me-2"></i>Volver
              </a>
            </div>


          </form>
          <script>
          // Validación visual en tiempo real de contraseña
          document.addEventListener('DOMContentLoaded', function() {
            var pwInput = document.getElementById('id_password1');
            if (pwInput) {
              pwInput.addEventListener('input', function() {
                var val = pwInput.value;
                // Validación longitud
                var len = document.getElementById('pw-len');
                if (val.length >= 8) {
                  len.classList.remove('text-danger');
                  len.classList.add('text-success');
                } else {
                  len.classList.remove('text-success');
                  len.classList.add('text-danger');
                }
                // Validación letras y números
                var mix = document.getElementById('pw-mix');
                var hasLetter = /[a-zA-Z]/.test(val);
                var hasNumber = /[0-9]/.test(val);
                if (hasLetter && hasNumber) {
                  mix.classList.remove('text-danger');
                  mix.classList.add('text-success');
                } else {
                  mix.classList.remove('text-success');
                  mix.classList.add('text-danger');
                }
              });
            }
          });
          </script>

        </div>
      </div>

    </div>
  </div>

</div>

{% endblock %}
