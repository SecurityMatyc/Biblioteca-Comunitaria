{% extends "base_panel.html" %}
{% load static %}

{% block title %}Devolver Libro - Biblioteca Comunitaria MJV{% endblock %}

{% block content %}

<div class="container mt-5 pt-5">
  <div class="row justify-content-center">
    <div class="col-lg-10">
      
      <!-- Encabezado -->
      <div class="text-center mb-4">
        <h1 class="display-5 fw-bold text-primary">
          <i class="fas fa-undo-alt me-2"></i>Devolver Libro
        </h1>
        <p class="lead text-muted">Registra la devolución de tus libros prestados</p>
      </div>

      <!-- Mensajes -->
      {% if messages %}
        <div class="mb-4">
          {% for message in messages %}
            <div class="alert alert-{% if 'Error' in message %}danger{% else %}success{% endif %} alert-dismissible fade show" role="alert">
              <strong>{{ message }}</strong>
              <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
          {% endfor %}
        </div>
      {% endif %}

      <!-- Préstamos Activos -->
      {% if prestamos %}
        <h3 class="text-center mb-4 fw-bold">Tus Préstamos Activos</h3>
        
        {% for prestamo in prestamos %}
          <div class="card shadow-sm mb-3 border-primary">
            <div class="card-body">
              <div class="row align-items-center">
                <div class="col-md-8">
                  <h4 class="card-title mb-3">
                    <i class="fas fa-book text-primary me-2"></i>{{ prestamo.libro.titulo }}
                  </h4>
                  <p class="mb-2"><strong>Autor:</strong> {{ prestamo.libro.autor }}</p>
                  <p class="mb-2"><strong>Fecha de Préstamo:</strong> {{ prestamo.fecha_prestamo|date:"d/m/Y" }}</p>
                  <p class="mb-2"><strong>Devolución Esperada:</strong> {{ prestamo.fecha_devolucion_esperada|date:"d/m/Y" }}</p>
                </div>
                
                <div class="col-md-4 text-center">
                  <form method="POST">
                    {% csrf_token %}
                    <input type="hidden" name="prestamo_id" value="{{ prestamo.id }}">
                    <button type="submit" class="btn btn-primary btn-lg w-100">
                      <i class="fas fa-check-circle me-2"></i>Devolver este Libro
                    </button>
                  </form>
                </div>
              </div>
            </div>
          </div>
        {% endfor %}
      {% else %}
        <div class="card shadow-sm border-0">
          <div class="card-body text-center p-5">
            <i class="fas fa-inbox fa-4x text-muted mb-4"></i>
            <p class="h5 text-muted mb-4">No tienes préstamos activos.</p>
            <a href="{% url 'registrar_prestamo' %}" class="btn btn-primary btn-lg">
              <i class="fas fa-book-reader me-2"></i>Solicitar un Libro
            </a>
          </div>
        </div>
      {% endif %}

    </div>
  </div>
</div>

{% endblock %}